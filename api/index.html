<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>OpenAI WebRTC Realtime</title>
</head>
<body>

<h2>ğŸ™ï¸ Voice Agent Realtime (OpenAI WebRTC)</h2>
<button id="startBtn">â–¶ Ø§Ø¨Ø¯Ø£</button>

<script>
async function start() {

    // 1) Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ SDP Ù…Ù† WebRTC Ø§Ù„Ù…ØªØµÙØ­
    const pc = new RTCPeerConnection();

    // Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙˆØª Ù…Ù† OpenAI
    const audio = new Audio();
    audio.autoplay = true;

    pc.ontrack = (ev) => {
        audio.srcObject = ev.streams[0];
    };

    // Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØª Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ†
    const mic = await navigator.mediaDevices.getUserMedia({ audio: true });
    mic.getTracks().forEach(t => pc.addTrack(t, mic));

    // Ø§ØµÙ†Ø¹ OFFER
    const offer = await pc.createOffer();
    await pc.setLocalDescription(offer);

    // 2) Ø£Ø±Ø³Ù„ Ø§Ù„Ù€ SDP Ø¥Ù„Ù‰ Ø¨Ø§Ùƒ Ø¥Ù†Ø¯
    const sdpResponse = await fetch("https://palpebral-inconsiderate-dovie.ngrok-free.dev/realtime/session", {
        method: "POST",
        headers: { "Content-Type": "application/sdp" },
        body: offer.sdp
    });

    if (!sdpResponse.ok) {
        console.error(await sdpResponse.text());
        return;
    }

    const answerSDP = await sdpResponse.text();

    // 3) Ø¶Ø¹ SDP OPENAI ÙƒÙ€ remote description
    await pc.setRemoteDescription({
        type: "answer",
        sdp: answerSDP
    });

    console.log("ğŸ‰ WebRTC Connected!");
}

document.getElementById("startBtn").onclick = start;
</script>


</body>
</html>
